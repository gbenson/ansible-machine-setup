---
- hosts: all
  tasks:
    - name: Install ~/.ssh/authorized_keys
      when: 0>1
      ansible.posix.authorized_key:
        user: "{{ lookup('env', 'USER') }}"
        state: present
        key: >
          {{ lookup('url', 'https://github.com/gbenson.keys') }}
          {{ lookup('env', 'USER') }}@inauspicious.org

    - name: Install packages
      become: yes
      ansible.builtin.apt:
        pkg:
          - docker.io
          - emacs-gtk
          - git
          - openssh-server
          - python3-dev
          - python3-venv
          - yaml-mode

    - name: Configure git
      ansible.builtin.copy:
        src: dotfiles/gitconfig
        dest: ~/.gitconfig
        mode: "0644"
        backup: yes

    - name: Configure Docker
      become: yes
      ansible.builtin.user:
        name: "{{ lookup('env', 'USER') }}"
        groups: docker
        append: yes
